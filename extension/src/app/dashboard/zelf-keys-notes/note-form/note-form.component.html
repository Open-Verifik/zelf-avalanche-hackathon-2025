<div class="note-form">
	<div class="form-header">
		<h2>{{ isNewNote ? "Add New Note" : "Edit Note" }}</h2>
		<p>Create a secure note with key-value pairs for easy organization</p>
	</div>

	<div class="form-content">
		<form (ngSubmit)="onSave()" #noteForm="ngForm">
			<!-- Title Section -->
			<div class="form-section">
				<label for="title" class="form-label">Note Title *</label>
				<input
					type="text"
					id="title"
					name="title"
					[(ngModel)]="noteData.title"
					(ngModelChange)="checkFormValidity()"
					class="form-input"
					placeholder="Enter note title"
					required
				/>
			</div>

			<!-- Key-Value Pairs Section -->
			<div class="form-section">
				<div class="section-header">
					<label class="form-label">Key-Value Pairs *</label>
					<button
						type="button"
						class="btn-add-pair"
						(click)="addKeyValuePair()"
						[disabled]="noteData.keyValuePairs.length >= maxKeyValuePairs"
					>
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
							<path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
						</svg>
						Add Pair
					</button>
				</div>

				<div class="key-value-pairs">
					<div *ngFor="let pair of noteData.keyValuePairs; let i = index" class="key-value-row">
						<input
							type="text"
							[(ngModel)]="pair.key"
							(ngModelChange)="checkFormValidity()"
							class="form-input key-input"
							placeholder="Key"
							required
						/>
						<input
							type="text"
							[(ngModel)]="pair.value"
							(ngModelChange)="checkFormValidity()"
							class="form-input value-input"
							placeholder="Value"
							required
						/>
						<button
							type="button"
							class="btn-remove-pair"
							(click)="removeKeyValuePair(i)"
							[disabled]="noteData.keyValuePairs.length <= 1"
							title="Remove this key-value pair"
						>
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
								<path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
							</svg>
						</button>
					</div>
				</div>

				<div class="pairs-info">
					<span class="pairs-count">{{ noteData.keyValuePairs.length }}/{{ maxKeyValuePairs }} pairs</span>
					<span class="pairs-hint">Add up to {{ maxKeyValuePairs }} key-value pairs</span>
				</div>
			</div>

			<!-- Folder Section -->
			<div class="form-section">
				<div class="folder-toggle">
					<label class="form-label">Organize in Folder</label>
					<div class="toggle-switch" (click)="toggleFolder()">
						<div class="toggle-slider" [class.active]="noteData.insideFolder"></div>
					</div>
				</div>

				<div *ngIf="noteData.insideFolder" class="folder-input">
					<input type="text" [(ngModel)]="noteData.folder" class="form-input" placeholder="Enter folder name" />
				</div>
			</div>

			<!-- Master Password Section -->
			<div class="form-section">
				<div class="password-toggle">
					<label class="form-label">Add Master Password (Optional)</label>
					<div class="toggle-switch" (click)="toggleMasterPassword()">
						<div class="toggle-slider" [class.active]="noteData.useMasterPassword"></div>
					</div>
				</div>

				<div *ngIf="noteData.useMasterPassword" class="password-input-field">
					<input
						type="password"
						id="masterPassword"
						name="masterPassword"
						[(ngModel)]="noteData.masterPassword"
						(ngModelChange)="checkFormValidity()"
						class="form-input"
						placeholder="Enter your master password (optional)"
					/>
					<small class="form-hint"
						>Adding a master password provides additional security layer. Biometric verification is always required.</small
					>
				</div>
			</div>

			<!-- Action Buttons -->
			<div class="form-actions">
				<button type="button" class="btn-secondary" (click)="onCancel()">Cancel</button>
				<button type="submit" class="btn-primary" [disabled]="!formValid" [class.btn-disabled]="!formValid">
					{{ isNewNote ? "Create Note" : "Update Note" }}
				</button>
			</div>
		</form>
	</div>

	<!-- Biometrics Modal -->
	<div *ngIf="showBiometrics" class="biometrics-modal">
		<div class="modal-content">
			<div class="modal-header">
				<h3>Verify Your Identity</h3>
				<p>Please verify your face to create this note</p>
			</div>
			<div class="modal-body">
				<app-data-biometrics
					[isDecryptMode]="false"
					[itemData]="noteData"
					(biometricsSuccess)="onBiometricsSuccess($event)"
					(biometricsCancel)="onBiometricsCancel()"
				>
				</app-data-biometrics>
			</div>
		</div>
	</div>
</div>
