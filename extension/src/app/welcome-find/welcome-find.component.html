<ng-container *ngIf="errorTitle">
    <welcome-error (goBack)="clearError()" [errorTitle]="errorTitle" [errorMessage]="errorMessage"></welcome-error>
</ng-container>

<ng-container *ngIf="!errorTitle">
    <div class="zelf-card" *transloco="let t">
        <div class="zelf-card__header welcome-find__header">
            <div class="welcome-find__header-button">
                <button mat-icon-button class="zelf-icon-button zelf-icon-button--40" [routerLink]="['../']">
                    <svg viewBox="0 0 22 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M20.0898 5.8277H4.72478L8.08478 2.4677C8.53978 2.0127 8.53978 1.2777 8.08478 0.822695C7.62978 0.367695 6.89478 0.367695 6.43978 0.822695L1.08478 6.1777C0.62978 6.6327 0.62978 7.3677 1.08478 7.8227L6.43978 13.1777C6.89478 13.6327 7.62978 13.6327 8.08478 13.1777C8.53978 12.7227 8.53978 11.9877 8.08478 11.5327L4.72478 8.16103H20.0898C20.7314 8.16103 21.2564 7.63603 21.2564 6.99436C21.2564 6.3527 20.7314 5.8277 20.0898 5.8277Z"
                        />
                    </svg>
                </button>
            </div>
        </div>

        <form [formGroup]="form" class="welcome-find__form">
            <div class="zelf-card__content welcome-find__content">
                <h2 class="zelf-card__title">{{ t("welcome.find_zelf_name_title") }}</h2>

                <p class="zelf-card__subtitle welcome-available__subtitle">
                    {{ t("welcome.find_zelf_name_subtitle") }}
                </p>

                <div class="zelf-input zelf-input--wide" [ngClass]="{ 'zelf-input--error': form.controls.publicAddress.invalid }">
                    <input
                        (click)="clearNotFound()"
                        (keydown.enter)="searchAddress()"
                        (paste)="pastedAddress($event)"
                        [disabled]="searching"
                        [readonly]="searching"
                        autocomplete="off"
                        class="zelf-input__control zelf-input__control--floating-label"
                        formControlName="publicAddress"
                        id="publicAddress"
                        name="publicAddress"
                        placeholder=" "
                    />

                    <label for="publicAddress" class="zelf-input__floating-label">{{ t("welcome.public_address_input") }}</label>

                    <button
                        (click)="searchAddress()"
                        [disabled]="searching || form.controls.publicAddress.invalid || !form.controls.publicAddress.value"
                        class="zelf-icon-button zelf-icon-button--black"
                        mat-icon-button
                        type="button"
                    >
                        <ng-container *ngIf="!searching">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M11.76 10.27L17.49 16L16 17.49L10.27 11.76C9.2 12.53 7.91 13 6.5 13C2.91 13 0 10.09 0 6.5C0 2.91 2.91 0 6.5 0C10.09 0 13 2.91 13 6.5C13 7.91 12.53 9.2 11.76 10.27ZM6.5 2C4.01 2 2 4.01 2 6.5C2 8.99 4.01 11 6.5 11C8.99 11 11 8.99 11 6.5C11 4.01 8.99 2 6.5 2Z"
                                />
                            </svg>
                        </ng-container>

                        <mat-spinner *ngIf="searching" mode="indeterminate" diameter="18"></mat-spinner>
                    </button>
                </div>

                <div class="zelf-message zelf-message--error zelf-message--column">
                    <ng-container *ngIf="notFound">
                        <div class="zelf-message__row">
                            <ng-container *ngTemplateOutlet="cross"></ng-container>
                            <p>{{ t("errors.not_found") }}</p>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="form.controls.publicAddress?.errors?.pattern">
                        <div class="zelf-message__row">
                            <ng-container *ngTemplateOutlet="cross"></ng-container>
                            <p>{{ t("errors.invalid_format") }}</p>
                        </div>
                    </ng-container>
                </div>
            </div>

            <div class="zelf-card__actions welcome-find__actions">
                <p>{{ t("welcome.upload_zelf_proof") }}</p>

                <div dragAndDrop class="welcome-find__actions-drag-drop drag-and-drop" (fileDropped)="onDrop($event)">
                    <input
                        (change)="fileBrowseHandler($event)"
                        #fileInput
                        accept=".png,.jpg,.jpeg"
                        formControlName="zelfProof"
                        hidden
                        id="zelfProof"
                        name="zelfProof"
                        type="file"
                    />

                    <div class="drag-and-drop__loader" *ngIf="loading">
                        <zelf-loader [diameter]="60"></zelf-loader>
                    </div>

                    <button
                        (click)="fileInput.click()"
                        [disabled]="searching || loading"
                        class="zelf-button zelf-button--outlined zelf-button--wide"
                        mat-flat-button
                        type="button"
                    >
                        {{ t("common.upload_qr_image") }}

                        <svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M4.5 10.2217H7.5C7.9125 10.2217 8.25 9.88422 8.25 9.47172V5.72172H9.4425C10.11 5.72172 10.4475 4.91172 9.975 4.43922L6.5325 0.996719C6.24 0.704219 5.7675 0.704219 5.475 0.996719L2.0325 4.43922C1.56 4.91172 1.89 5.72172 2.5575 5.72172H3.75V9.47172C3.75 9.88422 4.0875 10.2217 4.5 10.2217ZM1.5 11.7217H10.5C10.9125 11.7217 11.25 12.0592 11.25 12.4717C11.25 12.8842 10.9125 13.2217 10.5 13.2217H1.5C1.0875 13.2217 0.75 12.8842 0.75 12.4717C0.75 12.0592 1.0875 11.7217 1.5 11.7217Z"
                                fill="#181818"
                            />
                        </svg>
                    </button>

                    <p class="zelf-card__help-text">{{ t("common.or_drag_and_drop") }}</p>
                </div>
            </div>
        </form>
    </div>
</ng-container>

<ng-template #cross>
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
            d="M10 0C4.47 0 0 4.47 0 10C0 15.53 4.47 20 10 20C15.53 20 20 15.53 20 10C20 4.47 15.53 0 10 0ZM14.3 14.3C13.91 14.69 13.28 14.69 12.89 14.3L10 11.41L7.11 14.3C6.72 14.69 6.09 14.69 5.7 14.3C5.31 13.91 5.31 13.28 5.7 12.89L8.59 10L5.7 7.11C5.31 6.72 5.31 6.09 5.7 5.7C6.09 5.31 6.72 5.31 7.11 5.7L10 8.59L12.89 5.7C13.28 5.31 13.91 5.31 14.3 5.7C14.69 6.09 14.69 6.72 14.3 7.11L11.41 10L14.3 12.89C14.68 13.27 14.68 13.91 14.3 14.3Z"
            fill="#DC362E"
        />
    </svg>
</ng-template>
